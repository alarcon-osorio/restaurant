<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<header th:insert="includes/header :: header"> </header>
<header th:insert="includes/navbar :: navbar"> </header>

<div class="container mt-4 vj-destacados">
    <div class="row">
        <div class="col col-md-12 text-left mb-4" sec:authorize="isAuthenticated()">
            <div>
                <a class="font-weight-bold">Bienvenido: Mesero</a>
                <img src="https://i.pinimg.com/originals/6c/ed/a5/6ceda58e688c161b04800864a34988f6.jpg" width="45" height="45" class="d-inline-block align-top rounded-circle" alt="" loading="lazy">
                <p class="owner-subtext"><a href="/">Cerrar Sesión</a></p>
            </div>
            <div class="btn-group" style="width:100%">
                <a th:href="@{/menu}" class="btn btn-outline-danger">Menú</a>
                <a th:href="@{/orders?table=0}" class="btn btn-outline-warning">Todo</a>
                <a th:each="tableNumberList : ${tableNumberList}" th:href="@{/orders(table=${tableNumberList})}" th:text="'Mesa ' + ${tableNumberList}" class="btn btn-outline-success"></a>
            </div>
        </div>
    </div>

    <div class="row" th:if="${table} == 0">
        <div th:if="${success} == 'ok'" class="alert alert-success alert-dismissible fade show" role="alert">
            <strong>Exito!</strong> Pedido ordenado exitosamente...<a href="/menu">  /  Volver al Menú</a>.
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="col-md-12  mb-4">
            <h1 th:text="'Resumen de Pedidos'" style="text-align:center;"></h1>
            <div class="alert alert-danger" role="alert" th:if="${withOutOrders} == 'ok'">
                Sin pedidos para procesar
            </div>
            <br>
            <div class="card" th:each="serviceOrderList : ${serviceOrderList}" style="margin-bottom: 42px;">
                <br>
                <h1 th:text="'Mesa: ' +${serviceOrderList.tableNumber}" class="card-title" style="text-align: center;"></h1>
                <hr>
                <div class="container">
                    <div class="card-body">
                        <input type="hidden" th:value="${serviceOrderList.id}">
                        <h5 th:text="'Nombre del plato: ' + ${serviceOrderList.name}"></h5>
                        <h5 th:if="${serviceOrderList.accompaniment}" th:text="'Acompañamientos: ' + ${serviceOrderList.accompaniment}"></h5>
                        <h5 th:if="${serviceOrderList.option1}" th:text="'Caldo: ' + ${serviceOrderList.option1}"></h5>
                        <h5 th:if="${serviceOrderList.option2}" th:text="'Huevos: ' + ${serviceOrderList.option2}"></h5>
                        <h5 th:if="${serviceOrderList.option3}" th:text="'Bebida: ' + ${serviceOrderList.option3}"></h5>
                        <h5 th:if="${serviceOrderList.option4}" th:text="'Complemento: ' + ${serviceOrderList.option4}"></h5>
                        <h5 th:if="${serviceOrderList.drinksIncludes}" th:text="'Bebida Incluida: ' + ${serviceOrderList.drinksIncludes}"></h5>
                        <h5 th:text="'Observaciones: ' + ${serviceOrderList.observations}" class="card-title"></h5>
                        <h5 th:text="'Cantidad: ' + ${serviceOrderList.cant}"></h5>
                    </div>
                </div>
                <div class="btn-group" th:if="${empty} == empty">
                    <a th:href="@{/menu}" class="btn btn-outline-danger">Atrás</a>
                </div>
                <div class="btn-group" th:if="${empty} != empty" style="margin-left: 10px;">
                    <a th:if="${serviceOrderList.ordered} == 0" th:href="@{/order_table(id=${serviceOrderList.id})}" class="btn btn-outline-success">Ordenar Mesa</a>
                    <a th:if="${serviceOrderList.ordered} == 0" th:href="@{/edit_order_table(id=${serviceOrderList.id})}" class="btn btn-outline-info">Editar Mesa</a>
                    <a th:if="${serviceOrderList.ordered} == 0" th:href="@{/cancel_order_table(id=${serviceOrderList.id})}" class="btn btn-outline-danger">Cancelar Mesa</a>
                    <a th:if="${serviceOrderList.ordered} == 1 and ${serviceOrderList.prepare} == 0" th:href="@{/orders?table=0}" class="btn btn-outline-danger"><span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> Pedido en Cocina ...</a>
                    <a th:if="${serviceOrderList.ordered} == 1 and ${serviceOrderList.prepare} == 1  and ${serviceOrderList.prepared} == 0" th:href="@{/orders?table=0}" class="btn btn-outline-warning"><span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> En Preparación ...</a>
                    <a th:if="${serviceOrderList.prepared} == 1 and ${serviceOrderList.served} == 0" th:href="@{/served(id=${serviceOrderList.id})}" class="btn btn-outline-info"><span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> Pedido Listo -> Servir en la mesa</a>
                    <a th:if="${serviceOrderList.served} == 1" th:href="@{/menu}" class="btn btn-outline-success">Servido en la mesa</a>
                </div>
            </div>
        </div>
    </div>

    <div class="row" th:if="${table} != 0">
        <div th:if="${success} == 'ok'" class="alert alert-success alert-dismissible fade show" role="alert">
            <strong>Exito!</strong> Pedido ordenado exitosamente...<a href="/menu">  /  Volver al Menú</a>.
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="col-md-12  mb-4">
            <div class="card">
                <br>
                <h1 th:text="'Mesa: ' +${table}" class="card-title" style="text-align: center;"></h1>
                <hr>
                <div class="card-body" th:if="${empty} == empty">
                    <h6 style="text-align: center;" th:text="'No existe pedido en esta mesa'" class="card-title"></h6>
                </div>
                <form th:action="@{/confirm_order}" method="get">
                    <div th:each="tableNumber : ${tableNumber}" >
                        <div class="card-body">
                            <input type="hidden" th:value="${table}" name="table">
                            <h5 th:text="'Nombre del plato: ' + ${tableNumber.name}" class="card-title" ></h5>
                            <h5 th:if="${tableNumber.accompaniment}" th:text="'Acompañamientos: ' +${tableNumber.accompaniment}"></h5>
                            <h5 th:if="${tableNumber.option1}" th:text="'Caldo: ' +${tableNumber.option1}"></h5>
                            <h5 th:if="${tableNumber.option2}" th:text="'Huevos: ' +${tableNumber.option2}"></h5>
                            <h5 th:if="${tableNumber.option3}" th:text="'Bebida: ' +${tableNumber.option3}"></h5>
                            <h5 th:if="${tableNumber.option4}" th:text="'Complemento: ' +${tableNumber.option4}"></h5>
                            <h5 th:if="${tableNumber.drinksIncludes}" th:text="'Bebida Incluida: ' +${tableNumber.drinksIncludes}"></h5>
                            <h5 th:text="'Observaciones: ' +${tableNumber.observations}" class="card-title"></h5>
                            <h5 th:text="'Cantidad: ' +${tableNumber.cant}"></h5>
                        </div>
                        <hr>
                    </div>
                    <div class="btn-group" th:if="${empty} == empty">
                        <a th:href="@{/orders?table=0}" class="btn btn-outline-danger btn-person">Atrás</a>
                    </div>
                    <div class="btn-group" th:if="${empty} != empty">
                        <button th:if="${disableButton} != ok" type="submit" class="btn btn-outline-success btn-person">Ordenar Pedido</button>
                        <a th:if="${disableButton} != ok" th:href="@{/cancel_order(table=${table})}" class="btn btn-outline-danger">Cancelar Orden</a>
                        <a th:if="${ordered} == ok" th:href="@{/orders?table=0}" class="btn btn-outline-danger btn-person"><span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> Plato en Cocina...</a> <!--TODO: Contador de platos-->
                        <a th:if="${prepare} == ok" th:href="@{/orders?table=0}" class="btn btn-outline-warning btn-person"><span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> En preparación...</a> <!--TODO: Contador de platos-->
                        <a th:if="${prepared} == ok" th:href="@{/orders?table=0}" class="btn btn-outline-info btn-person"><span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> Plato Listo -> Servir en la mesa</a> <!--TODO: Contador de platos-->
                        <a th:if="${served} == ok" th:href="@{/orders?table=0}" class="btn btn-outline-success btn-person"></span> Plato servido en la Mesa</a> <!--TODO: Contador de platos-->
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<footer th:insert="includes/footer :: footer"> </footer>
<script type="text/javascript">
  function actualizar(){
    location.reload(true);
  }
  setInterval("actualizar()",10000);
</script>
</html>